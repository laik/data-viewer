import { lighten } from '@jiaminghi/color';
import { observable } from 'mobx';
import React from 'react';
import { bind } from '../../core/utils';
import { BaiduMap, BMapRef } from '../bmap';
import { BMapTrackAnimation } from '../bmap/animation';
import { withMapApi } from '../bmap/wrapper';
import line139 from './data/139line.json';
import gz from './data/gz.json';
import tracks from './data/tracks.json';
import { convert, literalToPoint, Point, Region, sRGBHex, Tracks } from './tool';




const mapvgl = require('mapvgl');


@withMapApi
@bind()
export default class Layout extends React.Component {
    @observable bmapRef: BMapRef = null;
    @observable districtPrism = observable.map({});

    setzoom = (size: number) => { this.bmapRef.map.setZoom(size) }
    getzoom = (): number => { return this.bmapRef.map.getZoom() }
    zoomOut = () => { this.setzoom(this.getzoom() - 2) }
    zoomIn = () => { this.setzoom(this.getzoom() + 2) }

    disableDistrict = () => { this.bmapRef.map.clearOverlays(); }

    enableDistrict = () => {
        this.districtPrism.forEach((overlay) => { this.bmapRef.map.addOverlay(overlay) })
    }

    displayVehicleFlow = (tracks: Tracks) => {
        console.log("--->", tracks);
        var layer = new mapvgl.LineFlowLayer({
            color: 'rgb(0, 255, 255)',
            interval: 0.7,
            duration: 4,
            trailLength: 1,
            zoom: 4,
            data: [
                {
                    geometry: {
                        type: 'LineString',
                        coordinates: [
                            [113.337041, 23.155499],
                            [113.337512, 23.155325],
                            [113.337512, 23.155325],
                            [113.337632, 23.155284],
                            [113.337832, 23.155213],
                            [113.338012, 23.155141],
                            [113.338493, 23.154988],
                            [113.338933, 23.154835],
                            [113.339194, 23.154753],
                            [113.339424, 23.154681],
                            [113.339924, 23.154498],
                            [113.340135, 23.154427],
                            [113.340975, 23.154162],
                            [113.341276, 23.154061],
                            [113.341726, 23.153908],
                            [113.342386, 23.153696],
                            [113.342726, 23.153584],
                            [113.342986, 23.153504],
                            [113.343447, 23.153342],
                            [113.343607, 23.153282],
                            [113.344257, 23.15304],
                            [113.345307, 23.152698],
                            [113.345957, 23.152488],
                            [113.348736, 23.151589],
                            [113.348756, 23.151579],
                            [113.350075, 23.151263],
                            [113.350804, 23.151156],
                            [113.352143, 23.150942],
                            [113.352542, 23.150884],
                            [113.352742, 23.150855],
                            [113.352822, 23.150835],
                            [113.353191, 23.150777],
                            [113.353721, 23.150701],
                            [113.35404, 23.150653],
                            [113.35447, 23.150596],
                            [113.354579, 23.150587],
                            [113.354669, 23.150577],
                            [113.354929, 23.150549],
                            [113.356945, 23.150456],
                            [113.357384, 23.15047],
                            [113.358113, 23.150488],
                            [113.358363, 23.15051],
                            [113.360039, 23.150639],
                            [113.360757, 23.150707],
                            [113.363101, 23.150897],
                            [113.363809, 23.150897],
                            [113.364667, 23.150849],
                            [113.364956, 23.150813],
                            [113.365404, 23.15074],
                            [113.365574, 23.150713],
                            [113.365633, 23.150694],
                            [113.365793, 23.150666],
                            [113.366471, 23.150496],
                            [113.3666, 23.150458],
                            [113.367238, 23.150278],
                            [113.368105, 23.150042],
                            [113.368205, 23.150014],
                            [113.368564, 23.14992],
                            [113.369231, 23.14976],
                            [113.369371, 23.149723],
                            [113.369371, 23.149723],
                            [113.369411, 23.149713],
                            [113.36954, 23.149676],
                            [113.370387, 23.14946],
                            [113.371383, 23.149177],
                        ]
                    }
                },
                {
                    geometry: {
                        type: 'LineString',
                        coordinates: [
                            [113.34963, 23.142911],
                            [113.34963, 23.142901],
                            [113.34971, 23.142871],
                            [113.34971, 23.142871],
                            [113.34982, 23.143161],
                            [113.34992, 23.143352],
                            [113.35008, 23.143652],
                            [113.35016, 23.143742],
                            [113.35025, 23.143853],
                            [113.35066, 23.144374],
                            [113.35086, 23.144625],
                            [113.35092, 23.144705],
                            [113.35157, 23.145498],
                            [113.35175, 23.145709],
                            [113.35181, 23.145779],
                            [113.35181, 23.145779],
                            [113.35231, 23.146432],
                            [113.35251, 23.146803],
                            [113.35255, 23.147033],
                            [113.35257, 23.147153],
                            [113.3526, 23.147314],
                            [113.3526, 23.147404],
                            [113.3526, 23.147544],
                            [113.352601, 23.148534],
                            [113.352591, 23.148714],
                            [113.352591, 23.149024],
                            [113.352581, 23.149374],
                            [113.352581, 23.149394],
                            [113.352622, 23.150174],
                            [113.352662, 23.150394],
                            [113.352702, 23.150645],
                            [113.352872, 23.151526],
                            [113.352872, 23.151526],
                            [113.352933, 23.151826],
                            [113.353033, 23.152167],
                            [113.353303, 23.152838],
                            [113.353363, 23.152939],
                            [113.353463, 23.15311],
                            [113.353533, 23.15324],
                            [113.353603, 23.15335],
                            [113.353713, 23.153561],
                            [113.353713, 23.153561],
                            [113.353733, 23.153601],
                            [113.353903, 23.153882],
                            [113.353953, 23.153973],
                            [113.354123, 23.154264],
                            [113.354263, 23.154465],
                            [113.354323, 23.154556],
                            [113.354683, 23.155058],
                            [113.354853, 23.155279],
                            [113.354923, 23.15536],
                            [113.355113, 23.155501],
                            [113.355282, 23.155623],
                            [113.355742, 23.155947],
                            [113.355792, 23.155977],
                            [113.356152, 23.15624],
                            [113.356541, 23.156524],
                            [113.35727, 23.15724],
                            [113.3574, 23.157362],
                            [113.35772, 23.157645],
                            [113.358009, 23.157798],
                            [113.358369, 23.157901],
                            [113.358399, 23.157912],
                            [113.358399, 23.157912],
                            [113.358548, 23.157933],
                            [113.358668, 23.157944],
                            [113.358648, 23.158004],
                            [113.358648, 23.158004],
                            [113.358439, 23.157992],
                            [113.358359, 23.157981],
                            [113.358289, 23.157961],
                            [113.357979, 23.157857],
                            [113.35768, 23.157704],
                            [113.35756, 23.157603],
                            [113.35734, 23.157411],
                            [113.357221, 23.1573],
                            [113.356791, 23.156896],
                            [113.356591, 23.156694],
                            [113.356361, 23.156502],
                            [113.356172, 23.15636]
                        ]
                    }
                },
                {
                    geometry: {
                        type: 'LineString',
                        coordinates: [
                            [113.370514, 23.247801],
                            [113.370274, 23.248147],
                            [113.370195, 23.248256],
                            [113.370115, 23.248395],
                            [113.370015, 23.248713],
                            [113.369955, 23.248802],
                            [113.369816, 23.248889],
                            [113.369527, 23.248895],
                            [113.369098, 23.248798],
                            [113.368979, 23.248796],
                            [113.368799, 23.248873],
                            [113.368011, 23.24953],
                            [113.367812, 23.249607],
                            [113.367533, 23.249752],
                            [113.367034, 23.249934],
                            [113.366197, 23.250241],
                            [113.365948, 23.250327],
                            [113.365609, 23.250472],
                            [113.36525, 23.250617],
                            [113.36525, 23.250617],
                            [113.363934, 23.251158],
                            [113.363355, 23.25146],
                            [113.363176, 23.251587],
                            [113.363066, 23.251706],
                            [113.362916, 23.251904],
                            [113.362667, 23.25225],
                            [113.362049, 23.253072],
                            [113.361919, 23.25325],
                            [113.36142, 23.253894],
                            [113.36135, 23.253993],
                            [113.36135, 23.253993],
                            [113.361161, 23.253991],
                            [113.360911, 23.253978],
                            [113.360762, 23.253966],
                            [113.360632, 23.253954],
                            [113.360263, 23.25393],
                            [113.359824, 23.253905],
                            [113.359704, 23.253934],
                            [113.359505, 23.254061],
                            [113.359505, 23.254061],
                            [113.359205, 23.254228],
                            [113.359205, 23.254228],
                            [113.358766, 23.254323],
                            [113.358766, 23.254323],
                            [113.358706, 23.254783],
                            [113.358706, 23.254783],
                            [113.358637, 23.255142],
                            [113.358547, 23.255291],
                            [113.358427, 23.25542],
                            [113.358367, 23.255489],
                            [113.358367, 23.255489],
                            [113.358547, 23.255721],
                            [113.359205, 23.256538],
                            [113.359076, 23.256637],
                            [113.359076, 23.256637],
                            [113.358916, 23.256445],
                            [113.358796, 23.256304],
                            [113.358337, 23.255719],
                            [113.357758, 23.255003],
                            [113.357689, 23.254922],
                            [113.357399, 23.254569],
                            [113.357279, 23.254428],
                            [113.35687, 23.253934],
                            [113.35684, 23.253884],
                            [113.356182, 23.253068],
                            [113.356162, 23.253038],
                            [113.355892, 23.252676],
                            [113.355832, 23.252585],
                            [113.355782, 23.252505],
                            [113.355673, 23.252354],
                            [113.355623, 23.252284],
                            [113.355553, 23.252163],
                            [113.355214, 23.25146],
                            [113.355214, 23.25146],
                            [113.355094, 23.251159],
                            [113.354944, 23.250698],
                            [113.354864, 23.250368],
                            [113.354824, 23.250188],
                            [113.354765, 23.249907],
                            [113.354705, 23.249787],
                            [113.354715, 23.249407],
                            [113.354715, 23.249407],
                            [113.354725, 23.249157],
                            [113.354735, 23.248787],
                            [113.354795, 23.248297],
                            [113.354925, 23.247768],
                            [113.355035, 23.247349],
                            [113.355045, 23.247299],
                            [113.355115, 23.24703],
                            [113.355165, 23.24683],
                            [113.355215, 23.246601],
                            [113.355305, 23.246292],
                            [113.355445, 23.245723],
                            [113.355505, 23.245453],
                            [113.355535, 23.245363],
                            [113.355575, 23.245184],
                            [113.355695, 23.244695],
                            [113.355925, 23.244087],
                            [113.356205, 23.243449],
                            [113.356305, 23.24324],
                            [113.356615, 23.242543],
                            [113.356735, 23.242284],
                            [113.356835, 23.241985],
                            [113.356925, 23.241726],
                            [113.356995, 23.241327],
                            [113.357016, 23.240867],
                            [113.356976, 23.240257],
                            [113.356857, 23.239366],
                            [113.356678, 23.238924],
                            [113.356538, 23.238653],
                            [113.356269, 23.238281],
                            [113.356, 23.237968],
                            [113.35565, 23.237665],
                            [113.355561, 23.237595],
                            [113.355231, 23.237332],
                            [113.355012, 23.23717],
                            [113.354653, 23.236888],
                            [113.354483, 23.236757],
                            [113.354204, 23.236505],
                            [113.353006, 23.235107],
                            [113.352108, 23.234053],
                            [113.352009, 23.233922],
                            [113.351749, 23.233571],
                            [113.351619, 23.23339],
                            [113.35141, 23.232979],
                            [113.351121, 23.232108],
                            [113.350992, 23.231288],
                            [113.351013, 23.230738],
                            [113.351093, 23.230169],
                            [113.351173, 23.229859],
                            [113.351213, 23.229749],
                            [113.351223, 23.229699],
                            [113.351354, 23.22931],
                            [113.351434, 23.22911],
                            [113.351454, 23.22905],
                            [113.351684, 23.228562],
                            [113.352314, 23.227665],
                            [113.352384, 23.227575],
                            [113.352454, 23.227476],
                            [113.352544, 23.227356],
                            [113.352795, 23.226928],
                            [113.352875, 23.226648],
                            [113.352875, 23.226648],
                            [113.353437, 23.223392],
                            [113.353437, 23.223392],
                            [113.353498, 23.222883],
                            [113.353488, 23.222533],
                            [113.353389, 23.221762],
                            [113.353241, 23.220582],
                            [113.353231, 23.220481],
                            [113.353181, 23.220281],
                            [113.352932, 23.21947],
                            [113.352553, 23.218638],
                            [113.352454, 23.218417],
                            [113.352364, 23.218237],
                            [113.352184, 23.217836],
                            [113.351905, 23.217255],
                            [113.351427, 23.216213],
                            [113.351078, 23.215481],
                            [113.350948, 23.215181],
                            [113.350878, 23.215041],
                            [113.350549, 23.214329],
                            [113.350429, 23.214079],
                            [113.350409, 23.214039],
                            [113.350379, 23.213979],
                            [113.35034, 23.213869],
                            [113.3502, 23.213578],
                            [113.35015, 23.213468],
                            [113.3501, 23.213378],
                            [113.35004, 23.213228],
                            [113.34998, 23.213108],
                            [113.349941, 23.213028],
                            [113.349711, 23.212557],
                            [113.349631, 23.212387],
                            [113.349561, 23.212237],
                            [113.349482, 23.212036],
                            [113.349072, 23.211166],
                            [113.349003, 23.211025],
                            [113.348863, 23.210735],
                            [113.348593, 23.210155],
                            [113.348524, 23.209995],
                            [113.348424, 23.209785],
                            [113.347984, 23.208854],
                            [113.347256, 23.207273],
                            [113.346936, 23.206593],
                            [113.346736, 23.206173],
                            [113.345997, 23.204614],
                            [113.345837, 23.204264],
                            [113.345308, 23.203144],
                            [113.345108, 23.202725],
                            [113.344818, 23.202085],
                            [113.344628, 23.201696],
                            [113.344568, 23.201546],
                            [113.344318, 23.201016],
                            [113.344008, 23.200307],
                            [113.343958, 23.200167],
                            [113.343808, 23.199697],
                            [113.343688, 23.198858],
                            [113.343688, 23.198448],
                            [113.343728, 23.198168],
                            [113.343758, 23.197968],
                            [113.343768, 23.197878],
                            [113.343818, 23.197687],
                            [113.343858, 23.197427],
                            [113.343878, 23.197317],
                            [113.343938, 23.196967],
                            [113.344009, 23.196577],
                            [113.344028, 23.196477],
                            [113.344039, 23.196367],
                            [113.344129, 23.195827],
                            [113.344189, 23.195487],
                            [113.344199, 23.195157],
                            [113.344149, 23.194767],
                            [113.343978, 23.194167],
                            [113.343638, 23.193288],
                            [113.343538, 23.193028],
                            [113.343508, 23.192958],
                            [113.343378, 23.192669],
                            [113.343138, 23.192029],
                            [113.342417, 23.190322],
                            [113.342367, 23.190202],
                            [113.342337, 23.190132],
                            [113.342036, 23.189503],
                            [113.341686, 23.189005],
                            [113.340674, 23.18797],
                            [113.340514, 23.187801],
                            [113.340514, 23.187801],
                            [113.340304, 23.187502],
                            [113.340083, 23.187193],
                            [113.339923, 23.186854],
                            [113.339803, 23.186585],
                            [113.339602, 23.185726],
                            [113.339572, 23.185626],
                            [113.339502, 23.185347],
                            [113.339241, 23.184198],
                            [113.33921, 23.184088],
                            [113.338959, 23.18301],
                            [113.338668, 23.181782],
                            [113.338638, 23.181672],
                            [113.338618, 23.181562],
                            [113.338528, 23.181183],
                            [113.338497, 23.181073],
                            [113.338487, 23.181013],
                            [113.338457, 23.180903],
                            [113.338437, 23.180833],
                            [113.338357, 23.180494],
                            [113.338357, 23.180474],
                            [113.338156, 23.179925],
                            [113.338156, 23.179925],
                            [113.338056, 23.179696],
                            [113.337825, 23.179338],
                            [113.337394, 23.178831],
                            [113.337304, 23.178752],
                            [113.337304, 23.178752],
                            [113.337133, 23.178603],
                            [113.336893, 23.178405],
                            [113.336702, 23.178267],
                            [113.336201, 23.177871],
                            [113.336101, 23.177772],
                            [113.335399, 23.177219],
                            [113.335068, 23.176952],
                            [113.334918, 23.176854],
                            [113.334547, 23.176547],
                            [113.333764, 23.175936],
                            [113.333644, 23.175817],
                            [113.333644, 23.175817],
                            [113.333494, 23.175679],
                            [113.333343, 23.1755],
                            [113.333253, 23.175391],
                            [113.333353, 23.17525],
                            [113.333353, 23.17525],
                            [113.333593, 23.174897],
                            [113.333903, 23.174174],
                            [113.334313, 23.173149],
                            [113.334353, 23.172719],
                            [113.334312, 23.172559],
                            [113.334152, 23.172401],
                            [113.33343, 23.171929],
                            [113.332698, 23.171507],
                            [113.332618, 23.171448],
                            [113.332317, 23.171191],
                            [113.332317, 23.171191],
                            [113.331925, 23.170996],
                            [113.331414, 23.170792],
                            [113.330762, 23.170601],
                            [113.329919, 23.170452],
                            [113.328896, 23.170406],
                            [113.328174, 23.170456],
                            [113.327502, 23.170516],
                            [113.327171, 23.170551],
                            [113.325998, 23.170649],
                            [113.325446, 23.170648],
                            [113.324744, 23.170589],
                            [113.324362, 23.170525],
                            [113.32357, 23.170328],
                            [113.323017, 23.170138],
                            [113.322656, 23.169974],
                            [113.321913, 23.169596],
                            [113.320005, 23.168479],
                            [113.319112, 23.168034],
                            [113.318419, 23.167746],
                            [113.317194, 23.167318],
                            [113.316863, 23.167224],
                            [113.315216, 23.166773],
                            [113.314463, 23.166576],
                            [113.313781, 23.166388],
                            [113.312736, 23.166116],
                            [113.311532, 23.165797],
                            [113.310106, 23.165411],
                            [113.309805, 23.165336],
                            [113.309083, 23.165168],
                            [113.308812, 23.165122],
                            [113.307447, 23.164984],
                            [113.306645, 23.164987],
                            [113.305632, 23.165082],
                            [113.305401, 23.165106],
                            [113.304177, 23.165294],
                            [113.303967, 23.165327],
                            [113.301661, 23.165658],
                            [113.301601, 23.165668],
                            [113.30136, 23.165691],
                            [113.300418, 23.165763],
                            [113.300037, 23.165787],
                            [113.299846, 23.165799],
                            [113.299315, 23.165805],
                            [113.298724, 23.165812],
                            [113.297551, 23.165784],
                            [113.295097, 23.165615],
                            [113.293835, 23.165524],
                            [113.292193, 23.165404],
                            [113.290981, 23.16533],
                            [113.290391, 23.165342],
                            [113.289851, 23.165404],
                            [113.28908, 23.165546],
                            [113.28775, 23.165919],
                            [113.28684, 23.16611],
                            [113.28684, 23.16611],
                            [113.28676, 23.16625],
                            [113.28663, 23.16635],
                            [113.28645, 23.16636],
                            [113.28638, 23.16636],
                            [113.28623, 23.16637],
                            [113.285691, 23.16637],
                            [113.285391, 23.166349],
                            [113.284851, 23.166299],
                            [113.283741, 23.166136],
                            [113.282871, 23.165934],
                            [113.282541, 23.165853],
                            [113.282471, 23.165832],
                            [113.282282, 23.165742],
                            [113.282051, 23.165511],
                            [113.281981, 23.16538],
                            [113.281981, 23.16538],
                            [113.281941, 23.16537],
                            [113.281861, 23.16535],
                            [113.281861, 23.16535],
                            [113.280932, 23.165096],
                            [113.280932, 23.165096],
                            [113.280113, 23.164901],
                            [113.279294, 23.164816],
                            [113.277796, 23.164815],
                            [113.277796, 23.164815],
                            [113.276967, 23.164829],
                            [113.276418, 23.164824],
                            [113.276149, 23.164831],
                            [113.27544, 23.164835],
                            [113.274871, 23.164849],
                            [113.274871, 23.164849],
                            [113.274173, 23.164862],
                            [113.273245, 23.165022],
                            [113.273245, 23.165022],
                            [113.272527, 23.165203],
                            [113.271909, 23.165356],
                            [113.27133, 23.165499],
                            [113.270822, 23.165622],
                            [113.270423, 23.165767],
                            [113.270423, 23.165767],
                            [113.269925, 23.16598],
                            [113.269925, 23.16598],
                            [113.269845, 23.166089],
                            [113.269825, 23.166229],
                            [113.269825, 23.166469],
                            [113.269826, 23.166539],
                            [113.269746, 23.166718],
                            [113.269746, 23.166718],
                            [113.269596, 23.166806],
                            [113.269447, 23.166814],
                            [113.269277, 23.166731],
                            [113.269237, 23.166681],
                            [113.269157, 23.16649],
                            [113.269157, 23.16649],
                            [113.269177, 23.16633],
                            [113.269237, 23.166071],
                            [113.269247, 23.166041],
                            [113.269495, 23.165324],
                            [113.269625, 23.165216],
                            [113.269714, 23.165157],
                            [113.269774, 23.165118],
                            [113.269974, 23.165111],
                            [113.270143, 23.165193],
                            [113.270223, 23.165274],
                            [113.270383, 23.165406],
                            [113.270483, 23.165448],
                            [113.270642, 23.16549],
                            [113.270772, 23.165521],
                            [113.270772, 23.165521],
                            [113.271679, 23.165293],
                            [113.271679, 23.165293],
                            [113.272407, 23.165112],
                            [113.272986, 23.164959],
                            [113.273814, 23.164798],
                            [113.274502, 23.164735],
                            [113.2754, 23.164734],
                            [113.2754, 23.164734],
                            [113.27568, 23.164727],
                            [113.276139, 23.164731],
                            [113.276348, 23.164723],
                            [113.277307, 23.164721],
                            [113.278095, 23.164708],
                            [113.278095, 23.164708],
                            [113.279074, 23.164704],
                            [113.279244, 23.164546],
                            [113.279244, 23.164546],
                            [113.279343, 23.164546],
                            [113.279343, 23.164546],
                            [113.279643, 23.164538],
                            [113.279743, 23.164539],
                            [113.279743, 23.164539],
                            [113.280003, 23.16457],
                            [113.280352, 23.164612],
                            [113.281132, 23.164836],
                            [113.282371, 23.165172],
                            [113.282731, 23.165283],
                            [113.28366, 23.165546],
                            [113.28379, 23.165666],
                            [113.28379, 23.165666],
                            [113.28487, 23.165849],
                            [113.28547, 23.165889],
                            [113.28634, 23.16588],
                            [113.28712, 23.165789],
                            [113.28934, 23.165296],
                            [113.28983, 23.165234],
                            [113.290261, 23.165193],
                            [113.291181, 23.165189],
                            [113.291822, 23.165236],
                            [113.293074, 23.165329],
                            [113.294055, 23.165403],
                            [113.294416, 23.16542],
                            [113.295097, 23.165475],
                            [113.297561, 23.165644],
                            [113.298864, 23.16568],
                            [113.299746, 23.165661],
                            [113.300217, 23.165645],
                            [113.300528, 23.165621],
                            [113.301631, 23.165528],
                            [113.302563, 23.165416],
                            [113.302984, 23.16535],
                            [113.303967, 23.165197],
                            [113.304488, 23.165119],
                            [113.30513, 23.16502],
                            [113.306494, 23.164869],
                            [113.307547, 23.164863],
                            [113.30833, 23.16493],
                            [113.309103, 23.165048],
                            [113.309554, 23.16515],
                            [113.309855, 23.165215],
                            [113.311331, 23.16561],
                            [113.311592, 23.165676],
                            [113.312746, 23.165986],
                            [113.314172, 23.166371],
                            [113.316893, 23.167093]
                        ]
                    }
                }
            ],
        });
        this.bmapRef.addMapvglViewLayer('flow', layer);
        return layer;
    }

    displayVehicleFlowadAptation = (zoom: number) => {
        console.log("displayVehicleFlowadAptation", zoom);

        // if (zoom <= 10) {
        //     let viewlayer = this.bmapRef.getMapvglViewLayer('flow');
        //     viewlayer && viewlayer.setOptions({
        //         color: 'rgb(0, 255, 255)',
        //         interval: 0.7,
        //         duration: 4,
        //         trailLength: 1,
        //         // zoom: 4,
        //     });
        // } else if (zoom <= 12) {
        //     let viewlayer = this.bmapRef.getMapvglViewLayer('flow');
        //     viewlayer && viewlayer.setOptions({
        //         color: 'rgb(255, 255, 0)',
        //         interval: 0.2,
        //         duration: 4,
        //         trailLength: 2,
        //         // zoom: 4,
        //     });
        // } else
        if (zoom > 12) {
            this.disableDistrict();
        } else {
            this.enableDistrict();
        }

        if (zoom > 17) {
            this.bmapRef.disableMapvglViewLayer('flow');
        } else {
            this.bmapRef.enableMapvglViewLayer('flow');
        }

    }

    districtsAptation = (zoom: number) => {
        if (zoom <= 11) {
            let viewlayer = this.bmapRef.getMapvglViewLayer('flow');
            viewlayer && viewlayer.setOptions({
                color: 'rgb(1, 255, 255,0.5)',
                interval: 0.2,
                duration: 3,
                trailLength: 1,
                zoom: 4,
            });
        } else if (zoom >= 17 && zoom <= 20) {

        } else if (zoom >= 21 && zoom <= 22) {
            // this.bmapRef.removeMapvglViewLayer('flow');
        }
    }

    mapLoaded = (e) => {
        //初始化3D矢量图层
        this.initDistrictsPrism(gz);
        //开启3D矢量图层
        this.enableDistrict();
        // 开启车流量线路图层
        this.displayVehicleFlow(new Tracks(tracks));
    }

    onZoomend = (e) => {
        const size = e.target.getZoom();
        if (size < 12) {
            this.bmapRef.map.setTilt(0);
        } if (size >= 12 && size < 14) {
            this.bmapRef.map.setTilt(30);
        } else if (size >= 14 && size < 16) {
            this.bmapRef.map.setTilt(55);
        }
        else if (size >= 16 && size <= 22) {
            this.bmapRef.map.setTilt(65);
        }

        this.displayVehicleFlowadAptation(size);
    }

    onZoomstart = (e) => {
        const size = e.target.getZoom();
    }

    rightCilck = (e) => {
        this.zoomOut();
        // this.disableDistrict() // 测试关闭3D矢量图层


    }

    leftCilck = (e) => {
        this.zoomIn();
        // this.enableDistrict() // 测试开启3D矢量图层
        // this.bmapRef.map.setCenter(literalToPoint(e.target.lnglat));
        console.log(
            "map zoom", this.bmapRef.map.getZoom(),
            "map evt", e,
            "latlng", e.latlng,
        )
        // this.bmapRef.map.setCenter(e.latlng);
    }

    prism = (key: number, name: string, center: Point, points: any): BMapGL.Overlay => {
        const fillColor = sRGBHex[key];
        const fillOpacity = 0;
        const overlay = new BMapGL.Prism(
            points,
            0,
            {
                topFillColor: fillColor,
                topFillOpacity: fillOpacity,
                sideFillColor: fillColor,
                sideFillOpacity: fillOpacity,
                enableMassClear: true,
            });

        overlay.addEventListener('click', (e) => {
            alert("onclick")
            this.bmapRef.map.setCenter(literalToPoint(center));
        })
        overlay.addEventListener('mouseover', (e) => {
            // this.bmapRef.map.setCenter(literalToPoint(center));
            e.target.setTopFillColor(lighten(fillColor));
            e.target.setTopFillOpacity(0.5);
        })
        overlay.addEventListener('mouseout', (e) => {
            e.target.setTopFillColor(fillColor);
            e.target.setTopFillOpacity(fillOpacity);
        })
        return overlay;
    }


    initDistrictsPrism = (region: Region) => {
        for (let i = 0; i < region.features.length; i++) {
            const feature = region.features[i];
            const { geometry, properties } = feature;
            const { coordinates } = geometry;

            for (let j = 0; j < coordinates.length; j++) {
                const coordinate = coordinates[j];
                for (let k = 0; k < coordinate.length; k++) {
                    const area = coordinate[k];
                    this.districtPrism.set(
                        properties.name,
                        this.prism(
                            i,
                            properties.name,
                            properties.center,
                            convert(area),
                        )
                    );
                }
            }
        }
    }

    trackAnimation = (data: any[]): JSX.Element => {
        let path = [];
        for (let i = 0; i < data.length; i++) {
            path.push(new BMapGL.Point(Number(data[i][0]), Number(data[i][1])));
        }
        return (
            <BMapTrackAnimation
                poyline={new BMapGL.Polyline(path)}
                overallView={true}
                tilt={30}
                duration={20000}
                delay={3000}
            />
        );
    };

    render() {
        return (
            <BaiduMap
                ref={(ref: any) => { ref ? (this.bmapRef = ref) : null; }}
                zoomControl
                mapTypeControl
                scaleControl
                listeners={{
                    onClick: this.leftCilck,
                    onRightclick: this.rightCilck,
                    onLoad: this.mapLoaded,
                    onZoomend: this.onZoomend,
                    onZoomstart: this.onZoomstart,
                }}>
                {this.trackAnimation(line139)}
            </BaiduMap>
        );
    }
}